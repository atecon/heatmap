function bundle set_bundle_and_get_defaults (const list xlist,
                                             bundle opts[null])
    /* Compile self bundle by merging eventual information
    from 'opts' bundle. */

    if !exists(opts)
        bundle opts = null
    endif

    bundle self = default_values(xlist)
    self = opts + self          # override defaults

    return self
end function


function bundle default_values (const list xlist)
    /* Set default values. */

    bundle self = null
    scalar self.error = FALSE
    scalar self.verbose = 1
    string self.initializer = "random"
    scalar self.n_init = 10
    scalar self.max_iter = 300
    scalar self.tolerance = 1e-4
    string self.algorithm = "full"

    return self
end function


function bundle kmeans (const list xlist "Features",
                        const int n_clusters[2::2] "No. of clusters",
                        bundle opts[null] "Parameter bundle")
    /* Main public function. */

    if !exists(opts)
        bundle opts = null
    endif

    # TODO: Inform on how many obs got dropped
    smpl xlist --no-missing

    bundle self = set_bundle_and_get_defaults(xlist, opts)
    strings self.names_xlist = varnames(xlist)
    scalar self.n_clusters = n_clusters

    series cluster_id = initialize_clusters(self)
    #print xlist self.cluster_id -o

    matrix c = centroids(xlist, cluster_id)

    # Compute distances

    # Re-assign clusters to shortest distance

    return self
end function
